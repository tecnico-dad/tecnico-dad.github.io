<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <link href="../_css/labs-sd.css" rel="stylesheet" type="text/css"/>
    <link href="../_prettify/prettify.css" rel="stylesheet" type="text/css"/>
    <script src="../_prettify/prettify.js" type="text/javascript"></script>
    <title>Tratamento de erros com gRPC e testes de integração com JUnit</title>

    <style type="text/css">
        body {
            padding-left: 1em;
            padding-right: 1em;
        }

        .underlined {
            text-decoration: underline !important;
        }
    </style>
</head>

<body onload="prettyPrint()">
<div class="contexto">
    <p><a href="../index.html">Labs SD</a> &gt;</p>
</div>
<div class="titulo" id="1">
    <h1>Tratamento de erros com gRPC e testes de integração com JUnit</h1>
</div>
<div class="objectivos">
    <h2>Objetivos da semana</h2>
    <ul>
        <li>Aprender a enviar e receber erros com gRPC</li>
        <li>Aprender a fazer testes de integração utilizando JUnit</li>
    </ul>
</div>
<div class="corpo" style="padding-right: 2em">

<h2 id="conteudos">Materiais de apoio à aula</h2>
<ul>
    <li>
        <a href="grpc-error/index.html">Tratamento de erros com gRPC</a>
    </li>
    <li>
        <a href="junit-it/index.html">Testes de integração com JUnit</a>
    </li>
</ul>

<p class="exemplos">
    Exemplos:
</p>
<ul>
    <li><a href="https://github.com/tecnico-distsys/example_junit" target="_blank">JUnit <img src="../_img/github.png" alt="GitHub" height="16"></a></li>
    <ul>
        <li>Para experimentar o código: fazer <b><i>Clone or Download</b></i> e depois seguir as instruções do <b><tt>README</tt></b></li>
    </ul>
    </li>
    <li><a href="https://github.com/tecnico-distsys/example_error-test-grpc" target="_blank"><i>gRPC example with errors and tests</i> <img src="../_img/github.png" alt="GitHub" height="16"></a></li>
    <ul>
        <li>Para experimentar o código: fazer <b><i>Clone or Download</b></i> e depois seguir as instruções do <b><tt>README</tt></b></li>
    </ul>
    </li>
</ul>


<p>
&nbsp;
</p>
<hr />
        
<h2>Exercício</h2>
<p>
O <b>ponto de partida</b> é o código base que está no repositório <a href="https://github.com/tecnico-distsys/exercise_ttt-grpc" target="_blank">gRPC Tic Tac Toe exercise <img src="../_img/github.png" alt="GitHub" height="16"></a>.
O código deve ser obtido fazendo <b><i>Clone or Download</b></i> e depois seguir as instruções do <b><tt>README</tt></b>
</p>
    
<p>
    O objetivo do exercício é extender o comportamento de uma aplicação simples que simula o jogo do galo de modo a ser devolvido um erro caso a jogada seja inválida, o ponto de partida será o exercicío resolvido na aula anterior. 
    O procedimento <tt>play</tt> recebe o nome do jogador, e a coluna e a linha em que o mesmo pretende fazer umas jogada.<br />
    Para este fim, vai-se:
    <ol type="I">
        <li>
            Enviar informação de erro do servidor para o cliente;
        </li>
        <li>
            Apanhar a exceção do lado do cliente e imprimir uma mensagem de erro;
        </li>
    </ol>
</p>
<p>
    Vamos então começar!
</p>

<ol type="I">
    <li>
        <b>Enviar informação de erro do servidor para o cliente</b>
        <ol type="1">
            <li>
                Vamos adicionar um retorno de erro ao servidor caso a mensagem do pedido seja com uma jogada fora do tabuleiro.<br />
                Importar a definição de um estado de erro para argumentos inválidos:
                <pre class="prettyprint lang-java">
import static io.grpc.Status.INVALID_ARGUMENT;
...
                </pre>
            </li>
            <li>
                Verificar se a jogada está fora do tabuleiro e devolver o erro em caso afirmativo.
                <pre class="prettyprint lang-java">
...
PlayResult result = ttt.play(row, column, player);

if (result == PlayResult.OUT_OF_BOUNDS){
    responseObserver.onError(INVALID_ARGUMENT.withDescription("Input has to be a valid position").asRuntimeException());
}
else{
    // Send a single response through the stream.
    PlayResponse response = PlayResponse.newBuilder().setPlay(result).build();
    responseObserver.onNext(response);
    // Notify the client that the operation has been completed.
    responseObserver.onCompleted();
} 
...
                </pre>
            </li>
            <li>
                Do lado do cliente, vamos apanhar uma exceção e imprimir a mensagem de erro:
                <pre class="prettyprint lang-java">
play_res = null;
...
try{
    play_res =  stub.play(PlayRequest.newBuilder().setRow(row).setColumn(column).setPlayer(player).build()).getPlay();
    if (play_res != PlayResult.SUCCESS) {
        displayResult(play_res);
    }
}
catch (StatusRuntimeException e) {
    System.out.println("Caught exception with description: " + 
        e.getStatus().getDescription());
} 
                </pre>
                <br />
            </li>
        </ol>
    </li>
    <h3> Testes JUnit </h3>
    <p>
     Vamos agora executar testes JUnit. O <b>ponto de partida</b> é o código base que está no repositório <a href="https://github.com/tecnico-distsys/exercise_grpc_error_testing/tree/2022" target="_blank">exercise_grpc_error_testing branch 2022 <img src="../_img/github.png" alt="GitHub" height="16"></a>.
     O código deve ser obtido fazendo <b><i>Clone or Download</b></i> e depois seguir as instruções do <b><tt>README</tt></b>.
    </p>
    <p>
       </li>Execute para compilar e instalar todos os modúlos:

    <pre class="prettyprint lang-java">
    mvn clean install -DskipTests
    </pre>

    na diretoria base.
    </p>
    <p>
        Para saber mais pode consultar o repositório <a href="https://tecnico-distsys.github.io/04-rpc-error-test/junit-it/index.html" target="_blank">Testes de integração com JUnit <img src="../_img/github.png" alt="GitHub" height="16"></a>
</p>
     <div class="objectivos">    
         <h2>Atenção que na próxima semana há mini exercício!</h2>
    <p>
            Na próxima aula laboratorial (consultar o calendário das aulas laboratoriais), ser-lhe-á entregue uma alínea adicional que 
            estende a solução construída pelo guião acima (por exemplo, criando novos procedimentos remotos que representem operações 
                bancárias e fazer o tratamento de possíveis excepções que ocorram devido ao uso errôneo das mesmos).
                É, pois, esperado que, nessa aula, cada estudante traga este guião inteiramente resolvido.</p>
    </div>

<p>&nbsp;</p>
</div>
<hr/>
<div class="rodape">
    <p>&copy; Docentes de Sistemas Distribu&iacute;dos, <a href="http://www.dei.tecnico.ulisboa.pt/">Dep. Eng.
        Informática</a>, <a href="http://www.ist.eu">Técnico Lisboa</a>
        <br/>
    </p>
</div>
</body>
</html>
