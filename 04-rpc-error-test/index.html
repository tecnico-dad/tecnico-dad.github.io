<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <link href="../_css/labs-sd.css" rel="stylesheet" type="text/css"/>
    <link href="../_prettify/prettify.css" rel="stylesheet" type="text/css"/>
    <script src="../_prettify/prettify.js" type="text/javascript"></script>
    <title>Tratamento de erros com gRPC e testes de integração com JUnit</title>

    <style type="text/css">
        body {
            padding-left: 1em;
            padding-right: 1em;
        }

        .underlined {
            text-decoration: underline !important;
        }
    </style>
</head>

<body onload="prettyPrint()">
<div class="contexto">
    <p><a href="../index.html">Labs SD</a> &gt;</p>
</div>
<div class="titulo" id="1">
    <h1>Tratamento de erros com gRPC e testes de integração com JUnit</h1>
</div>
<div class="objectivos">
    <h2>Objetivos da semana</h2>
    <ul>
        <li>Aprender a enviar e receber erros com gRPC</li>
        <li>Aprender a fazer testes de integração utilizando JUnit</li>
    </ul>
</div>
<div class="corpo" style="padding-right: 2em">

<h2 id="conteudos">Materiais de apoio à aula</h2>
<ul>
    <li>
        <a href="grpc-error/index.html">Tratamento de erros com gRPC</a>
    </li>
    <li>
        <a href="junit-it/index.html">Testes de integração com JUnit</a>
    </li>
</ul>

<p class="exemplos">
    Exemplos:
</p>
<ul>
    <li><a href="https://github.com/tecnico-distsys/example_junit" target="_blank">JUnit <img src="../_img/github.png" alt="GitHub" height="16"></a></li>
    <ul>
        <li>Para experimentar o código: fazer <b><i>Clone or Download</b></i> e depois seguir as instruções do <b><tt>README</tt></b></li>
    </ul>
    </li>
    <li><a href="https://github.com/tecnico-distsys/example_error-test-grpc" target="_blank"><i>gRPC example with errors and tests</i> <img src="../_img/github.png" alt="GitHub" height="16"></a></li>
    <ul>
        <li>Para experimentar o código: fazer <b><i>Clone or Download</b></i> e depois seguir as instruções do <b><tt>README</tt></b></li>
    </ul>
    </li>
</ul>


<p>
&nbsp;
</p>
<hr />
        
<h2>Exercício</h2>
    
<p>
    O ponto de partida será <a href="https://tecnico-distsys.github.io/03-rpc/index.html">a solução que se espera que 
    o grupo tenha construído na aula anterior para o Jogo do Galo em gRPC</a>.</p>
    <p>O objetivo deste novo exercício é estender essa solução de modo a ser devolvido um erro caso um pedido de jogada leve argumentos inválidos, assim como adicionar-lhe alguns testes unitários.</p>
    
    <p>
    Vamos então começar!
</p>


<p><h3>
    Enviar informação de erro do servidor para o cliente</h3></p>


<p>Vamos agora adicionar um retorno de erro ao servidor caso a mensagem do pedido seja com uma jogada fora do tabuleiro. Relembramos que a operação <tt>play</tt> recebe o nome do jogador, e a coluna e a linha em que o mesmo pretende fazer umas jogada.</p>

        <p><ol type="1">
            <li>Comece por aprender sobre ler os materiais sobre <a href="grpc-error/index.html">o tratamento de erros com gRPC</a>.</li>
            <li>
                Vamos agora estender a sua solução. No servidor, comece por importar a definição de um estado de erro para argumentos inválidos:
                <pre class="prettyprint lang-java">
import static io.grpc.Status.INVALID_ARGUMENT;
...
                </pre>
            </li>
            <li>
                Verifique se a jogada está fora do tabuleiro e, em caso afirmativo, devolver o erro.
                <pre class="prettyprint lang-java">
...
PlayResult result = ttt.play(row, column, player);

if (result == PlayResult.OUT_OF_BOUNDS){
    responseObserver.onError(INVALID_ARGUMENT.withDescription("Input has to be a valid position").asRuntimeException());
}
else{
    // Send a single response through the stream.
    PlayResponse response = PlayResponse.newBuilder().setPlay(result).build();
    responseObserver.onNext(response);
    // Notify the client that the operation has been completed.
    responseObserver.onCompleted();
} 
...
                </pre>
            </li>
            <li>
                Do lado do cliente, deve apanhar uma exceção e imprimir a mensagem de erro:
                <pre class="prettyprint lang-java">
play_res = null;
...
try{
    play_res =  stub.play(PlayRequest.newBuilder().setRow(row).setColumn(column).setPlayer(player).build()).getPlay();
    if (play_res != PlayResult.SUCCESS) {
        displayResult(play_res);
    }
}
catch (StatusRuntimeException e) {
    System.out.println("Caught exception with description: " + 
        e.getStatus().getDescription());
} 
                </pre>
                <br />
            </li>
        </ol>
    </li>
    <h3> Testes JUnit </h3>
    <p>
     Vamos agora estender o seu Jogo do Galo com alguns testes JUnit.</p> 
    
    <ol type="1">
            <li>Comece por estudar os nossos materiais sobre <a href="https://tecnico-distsys.github.io/04-rpc-error-test/junit-it/index.html" target="_blank">testes de integração com JUnit <img src="../_img/github.png" alt="GitHub" height="16"></a></li>
            <li>Pode também consultar e experimentar <a href="https://github.com/tecnico-distsys/example_junit" alt="GitHub" height="16">este exemplo simples do uso de JUnit</a>.</li>
            <li>Agora experimente criar alguns testes unitários simples ao seu projeto do Jogo do Galo!</li>
    </ol>
    
</p>
     <div class="objectivos">    
         <h2>Atenção que na próxima semana há mini exercício!</h2>
    <p>
            Na próxima aula laboratorial (consultar o calendário das aulas laboratoriais), ser-lhe-á entregue uma alínea adicional que 
            estende a solução construída pelo guião acima (por exemplo, criando novos procedimentos remotos que representem operações 
                bancárias e fazer o tratamento de possíveis excepções que ocorram devido ao uso errôneo das mesmos).
                É, pois, esperado que, nessa aula, cada estudante traga este guião inteiramente resolvido.</p>
    </div>

<p>&nbsp;</p>
</div>
<hr/>
<div class="rodape">
    <p>&copy; Docentes de Sistemas Distribu&iacute;dos, <a href="http://www.dei.tecnico.ulisboa.pt/">Dep. Eng.
        Informática</a>, <a href="http://www.ist.eu">Técnico Lisboa</a>
        <br/>
    </p>
</div>
</body>
</html>
