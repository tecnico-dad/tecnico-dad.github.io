<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <link rel="stylesheet" type="text/css" href="../../_css/labs-sd.css"><!--/link-->

    <link href="../../_prettify/prettify.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="../../_prettify/prettify.js"></script>

    <title>Código de um Handler</title>

    <meta name="Generator" content="UltraEdit">
    <meta name="Author" content="Miguel Pardal">
    <meta name="Keywords" content="Exception in Java, tutorial">
    <meta name="Description" content="">
</head>

<body onload="prettyPrint()">

<div class="Código">
    <p>
        <a href="../../index.html">Labs SD</a> &gt;
        <a href="../index.html">SOAP Handlers</a>
    </p>
</div>

<h2 id="code">Código de um <i>Handler</i></h2>
<p>
<pre class="prettyprint">
package example.ws.handler;

import java.util.Set;
import javax.xml.namespace.QName;
import javax.xml.ws.handler.MessageContext;
import javax.xml.ws.handler.soap.SOAPHandler;
import javax.xml.ws.handler.soap.SOAPMessageContext;

public class EmptyHandler implements SOAPHandler<SOAPMessageContext> {

    /**
     * Gets the names of the header blocks that can be processed by this Handler instance.
     * If null, processes all.
     */
    public Set<QName> getHeaders() {
        return null;
    }

    /**
     * The handleMessage method is invoked for normal processing of inbound and
     * outbound messages.
     */
     public boolean <b>handleMessage</b>(SOAPMessageContext smc) {
        return true;
    }

    /** The handleFault method is invoked for fault message processing. */
    public boolean handleFault(SOAPMessageContext smc) {
        return true;
    }

    /**
     * Called at the conclusion of a message exchange pattern just prior to the
     * JAX-WS runtime dispatching a message, fault or exception.
     */
    public void close(MessageContext messageContext) {

    }

}
</pre>
</p>

<p>&nbsp;</p>
<h3 id="return">Processamento da mensagem</h3>

<p>
O retorno do método <tt>handleMessage()</tt> determina de que forma
prossegue o processamento da mensagem.<br />
Se for 'true' o processamento deve prosseguir;
se for 'false' bloqueia o processamento da mensagem,
mudando-lhe o sentido e
fazendo-a voltar para o cliente.
</p>
<p>
A utilização de <b>exceções</b> permite modificar o normal
processamento das mensagens SOAP:
</p>
<ul>
<li>
Se um <i>handler</i> atirar uma exceção <tt>java.lang.RuntimeException</tt>
(ou um sub-tipo desta classe), tal
indica que o processamento normal da mensagem deve parar.
O método <tt>close()</tt> é invocado nos <i>handlers</i> que entretanto já tinham
sido chamados, o sentido da mensagem é invertido
e a excepção é despachada.
Se a mensagem tinha o sentido de saída (<i>outbound</i>),
é gerada uma mensagem SOAP automaticamente
preenchida com uma SOAP <i>Fault</i>.
</li>
<li>
Se um <i>handler</i> atirar uma exceção <tt>javax.xml.ws.soap.SOAPFaultException</tt>
(que é um sub-tipo de <tt>javax.xml.ws.ProtocolException</tt>),
indica que o processamento normal da mensagem deve parar
e que se deve iniciar o processamento de mensagem de erro.
O sentido da mensagem é invertido,
se a mensagem não é ainda uma mensagem de Fault
é substituída por uma mensagem de Fault,
e o método <tt>handleFault()</tt> é invocado para o próximo <i>Handler</i> caso exista,
para que seja preenchida manualmente a informação da <i>Fault</i>.
</li>
</ul>

<hr />

<div class="rodape">
<p>
&copy; Docentes de Sistemas Distribuídos,
<a href="http://www.dei.tecnico.ulisboa.pt/">Dep. Eng. Informática</a>,
<a href="http://www.ist.eu">Técnico Lisboa</a><br />
</p>
</div>


</body>
</html>
