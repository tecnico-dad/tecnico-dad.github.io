<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
    <link rel="stylesheet" type="text/css" href="../_css/labs-sd.css">

    <link href="../_prettify/prettify.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="../_prettify/prettify.js"></script>

    <title>Web Services Contract-First</title>
</head>

<body onload="prettyPrint()">

<div class="contexto">
    <p>
        <a href="../index.html">Labs SD</a> &gt;
    </p>
</div>

<div class="titulo" id="1">
    <h1>Web Services Contract-First</h1>
</div>

<div class="objectivos">

    <h2>Objetivos</h2>
    <ul>
        <li>Desenvolver Web Services usando a abordagem <i>contract-first</i></li>
    </ul>
</div>

<div class="indice">
</div>

<div class="corpo">

<h2>Web Services</h2>

<p>
Um serviço é uma funcionalidade de um sistema informático que pode ser invocada remotamente através da rede.<br />
Um <i>Web Service</i> é um serviço que usa os protocolos de comunicação da <i>World Wide Web</i>
- HTTP sobre TCP sobre IP -
e protocolos adicionais para descrever mensagens e dados
- SOAP sobre XML.<br />
Para permitir uma definição rigorosa das operações e dos tipos de dados dos <i>Web Services</i>
são usadas as linguagens WSDL (<i>Web Services Description Language</i>) e
XSD (<i>XML Schema Definition</i>),
respetivamente.
</p>


<h3>Web Service contract</h3>

<p>
Os <i>Web Services</i> também têm uma linguagem própria para descrever o seu <b>contrato</b> com os clientes.<br />
A <b>WSDL</b> permite especificar a interface funcional (<i>port type</i>)
- operações com entradas, saídas e erros -
e também a vinculação (<i>binding</i>) com tecnologias concretas
- habitualmente SOAP sobre HTTP.<br />
A WSDL é baseada em XML de forma a ser independente da plataforma e
usa XSD para definir o detalhe dos tipos de dados de entrada e saída (e erros) em cada operação.
</p>

<p>
Exemplo:
<ul>
<li><a href="ping/Ping.wsdl">Ping.wsdl</a> -
os comentários numerados explicam as diferentes seções do documento:<br />
<i>namespaces</i>,
<i>service definition</i>,
<i>binding definitions</i>,
<i>port type definitions</i>,
<i>message definitions</i> e
<i>type definitions</i>.
</li>
</ul>
</p>

Mais informação:
<ul>
    <li>
<a href="wsdl/index.html">WSDL</a></li>
    </li>
    <li>
<a href="xml/index.html">XML</a> e
<a href="xsd/index.html">XSD</a>
    </li>
    <li>
    Livro Couloris, Capítulo 9
    </li>
</ul>


<h3>Java API for XML Web Services</h3>

<p>
As bibliotecas JAX (<i>Java API for XML</i>) são a família de bibliotecas da plataforma Java que lidam com tecnologias baseadas em XML,
como é o caso dos <i>Web Services</i>.<br />
A JAX-WS (Java API for XML Web Services) é uma biblioteca para Java que permite implementar <i>Web Services</i>,
usando as normas:<br />
HTTP/TCP/IP para mensagens,
SOAP/XML para mensagens,
WSDL e XSD para descrição.
</p>
<p>
É possível implementar Web Services partindo de um contrato WSDL (e XSD) já existente.<br />
Esta abordagem ao desenvolvimento de serviços é chamada <i>contract-first</i>.
</p>

<p>
Exemplo Ping Web Service:
<ul>
    <li>
    <a href="ping/ping-ws.zip">server
    <img src="../_img/zip.png" alt="ZIP" ></a>
    <a href="ping/uml_server.png"><img src="../_img/uml.png" alt="UML" ></a>
    </li>

    <li>
    <a href="ping/ping-ws-cli.zip">client
    <img src="../_img/zip.png" alt="ZIP" ></a>
    <a href="ping/uml_client.png"><img src="../_img/uml.png" alt="UML" ></a>
    </li>
</ul>
</p>

<p><small>
Nota: As pastas que contêm o código não devem ter espaços nem caracteres acentuados no seu caminho.
</small></p>

Mais informação:
<!--ul>
    <li--><a href="jaxws/index.html">JAX-WS</a><!--/li>
</ul-->


<h3>JUnit Integration Tests</h3>

<p>
Para garantir a qualidade do código do Web Service,
é necessário produzir testes de integração (<tt>IT</tt>)
que verificam o comportamento de todo o sistema através de invocações <i>remotas</i>.
</p>
<!--p>
O JUnit pode também ser usado para fazer testes de integração.
</p-->
<p>
No contexto dos Web Services,
os testes de integração são um programa cliente (<tt>ws-cli</tt>) que faz invocações remotas a um programa servidor (<tt>ws</tt>),
verificando o contrato das operações remotas definidas no WSDL.<br />
Assume-se que todos os Web Services já foram previamente lançados antes de correr os testes de integração.
</p>

Mais informação:
<!--ul>
    <li--><a href="junit-it/index.html">JUnit Integration Tests</a><!--/li>
</ul-->

<p>
&nbsp;
</p>
<hr />

<h1>Exercício</h1>

<p>
Partindo do exemplo acima,
foi construído um novo Web Service Tic Tac Toe (jogo do galo).<br />
<img src="ttt.png" alt="Tic Tac Toe" height="75" />
</p>
<ul>
    <li>
O ponto de partida foi o programa
<a href="ttt-local.zip">ttt-local</a>
    </li>
    <li>
O ponto de chegada consiste em dois programas:
<b>servidor</b> <a href="ttt-ws.zip">ttt-ws</a> e 
<b>cliente</b> <a href="ttt-ws-cli.zip">ttt-ws-cli</a>.
    </li>
</ul>
<ul>
    <li>
A estrutura dos projetos está montada mas,
<b>atenção</b>,<br />
<b>faltam ainda alterações importantes assinaladas com "..."</b>,<br />
quer no <tt>pom.xml</tt>, 
quer no código Java!
    </li>
</ul>
<ul>
    <li>
O <b>objetivo</b> do exercício é acrescentar o que falta e 
colocar o servidor e cliente a funcionar.
    </li>
</ul>

<p>&nbsp;</p>

<ol>
    <li>
No <b>servidor</b> (<tt>ttt-ws</tt>):
    </li>
    <ul>
        <li>
Configurar no ficheiro <tt>pom.xml</tt>:
        </li>
        <ul>
            <li>
A dependência para a biblioteca UDDINaming
(em falta dentro da tag <tt>&ltdependencies&gt</tt>).
            </li>
            <li>
A localização do UDDI (<tt>uddi.url</tt>)<br />
Por omissão, o valor é <tt>http://localhost:9090</tt>.
            </li>
            <li>
O nome do serviço a registar (<tt>ws.name</tt>)
            </li>
            <li>
O endereço do serviço a disponibilizar (<tt>ws.url</tt>)<br />
Por exemplo, <tt>http://localhost:8080/ttt-ws/endpoint</tt>
            </li>
        </ul>
    </ul>
    <ul>
        <li>
Consultar a interface <tt>TTT</tt> e
respectiva implementação <tt>TTTImpl</tt>
        </li>
        <li>
            Completar as anotações <tt>javax.jws.WebService</tt>,
            indicando a interface implementada: <tt>ttt.TTT</tt>
        </li>
        <pre class="prettyprint lang-java">

    @WebService(endpointInterface="...")
    public class TTTImpl implements TTT {

</pre>
        <li>
Depois de efectuadas as alterações:<br />
<tt>mvn compile exec:java</tt><br />
(a classe a executar e os argumentos estão definidos no <tt>pom.xml</tt>)<br />
        </li>
        <li>
Consultar o WSDL gerado dinamicamente,
que deverá estar disponível no endereço<br />
<a href="http://localhost:8080/ttt-ws/endpoint?WSDL">http://localhost:8080/ttt-ws/endpoint?WSDL</a>.
        </li>
    </ul>

<p>&nbsp;</p>

    <li>
No <b>cliente</b> (<tt>ttt-ws-cli</tt>):
    </li>
    <ul>
        <li>
Configurar no ficheiro <tt>pom.xml</tt>:
        </li>
        <ul>
            <li>
A dependência para a biblioteca UDDINaming
(em falta dentro da tag <tt>&ltdependencies&gt</tt>).
            </li>
            <li>
A localização do UDDI (<tt>uddi.url</tt>)<br />
            </li>
            <li>
O nome do serviço a pesquisar (<tt>ws.name</tt>)
            </li>
        </ul>
        <li>
Gerar o código necessário às invocações remotas a partir do WSDL:<br />
<tt>mvn generate-sources</tt><br />
O WSDL é necessário para a compilação do cliente,
pelo que o servidor deverá estar a correr.<br />
Caso se pretenda gerar novamente as classes,
deve fazer-se:<br />
<tt>mvn clean generate-sources</tt><br />		
        </li>
        <li>
Consultar <tt>./target/generated-sources/wsimport</tt> ou
faça <em>refresh</em> no <em>package explorer</em> do Eclipse.<br />
        </li>
        <ul>
            <li>
Verificar que alterações ocorreram nas pastas do projeto
em resultado da geração de código a partir do WSDL.<br />
Inspeccione o conteúdo dos novos ficheiros gerados e
tente compreender a função de cada um.
            </li>
            <li>
Abrir e
analisar o ficheiro cujo nome termina em <tt>...Service.java</tt>.<br />
A classe <tt>...Service</tt> estende a classe
<tt>javax.xml.ws.Service</tt>,
que é a classe que o JAX-WS fornece para acesso ao serviço remoto.<br />
A classe gerada já está configurada para o <i>Web Service</i> em causa,
logo é mais fácil de usar que usando a classe Service diretamente.
            </li>
        </ul>
        <li>
No método <tt>main()</tt> do cliente,
criar uma instância de <tt>...Service</tt> e
chamar o método <tt>get...Port()</tt>,
que retorna uma instância da interface (remota) do seu Web Service.
A partir daí,
pode invocar qualquer operação chamando métodos dessa interface.
        </li>
        <pre class="prettyprint lang-java">

    public Game() {
        ...

        ...Service service = new ...Service();
        ... port = service.get...Port();


</pre>
        <li>
            Agora já deverá ser possível compilar a aplicação sem erros:<br />
            <tt>mvn compile</tt>
        </li>
        <li>E jogar:<br />
          <tt>mvn exec:java</tt>
        </li>
    </ul>
</ol>

<h2>Perguntas</h2>

<ol type="1">
    <li>
        Estude o WSDL gerado.
        Consegue mapear o código Java para as definições WSDL e XSD?
    </li>
    <li>
        Onde, no WSDL,
        é especificado o tipo de argumentos do Web Service?
    </li>
    <li>
        Compare o WSDL gerado com o ficheiro <tt>ttt.x</tt> do servidor SUN RPC do ttt.
    </li>
    <ol type="a">
        <li>
            Que informação é comum a ambos os ficheiros?
        </li>
        <li>
            Que informação existe no WSDL mas não existe no .x?
        </li>
    </ol>
    <li>
        Identifique a função de cada ficheiro gerado no cliente
        (ignore os ficheiros <tt>ObjectFactory.java</tt> e <tt>package-info.java</tt> na sua resposta).
    </li>

	<li>
		As mensagens SOAP são impressas na consola do servidor.<br />
		A captura e impressão são feitas por um <i>handler</i> que será estudado em detalhe numa aula futura.
    </li>
	<ol type="a">
        <li>
            Qual é a estrutura da mensagem SOAP?<br />
			Pode indentar o texto XML para ser mais fácil de ler.
        </li>
        <li>
            Identifique uma mensagem SOAP que seja um pedido e outra que seja uma resposta.<br />
			Consegue ver a informação útil do pedido?
        </li>
    </ol>
</ol>

<p>
O resto do enunciado será entregue na aula.<br />
O objetivo será estender ou
modificar as funcionalidades disponíveis.
</p>


<p>
<b>Bom trabalho!</b>
</p>

<div class="objectivos">
<h2>Entrega da solução</h2>

<p>
    Fénix, Avaliação, Projetos, <b>mini Exercício 3 - Web Services</b>
</p>

<p>
    A solução completa deverá ser submetida no Fénix
    <b>antes do fim da sua aula de laboratório</b>.
    Trabalhos submetidos depois da hora de fim da aula não serão considerados.<br>
</p>

<p>
    <b>Ter atenção ao seguinte:</b>
</p>
<ul>
    <li>Só são aceites trabalhos de estudantes que estiveram
        presentes no laboratório.</li>
    <!--li>Deverá incluir um ficheiro <tt>respostas.txt</tt> com as
        respostas às perguntas do enunciado do exercício.
    </li-->
    <li>Deverá também incluir um ficheiro <tt>instrucoes.txt</tt>
        com resumo da funcionalidade implementada e com instruções para
        colocar o programa a funcionar como esperado.<br /> Por exemplo:
    </li>
    <ul>
        <li>A funcionalidade pedida foi total/parcialmente implementada
            <b>...</b>
        </li>
        <li>O servidor deve executar com o seguinte comando:<br />
        <tt>mvn clean install exec:java</tt>
        </li>
        <li>O cliente deve executar com o comando:<br />
        <!--tt>mvn compile exec:java</tt-->
        <tt>mvn clean verify</tt>
        </li>
    </ul>
    <li>Assegure-se que a solução é enviada em formato ZIP e que não
        contém código compilado (faça <tt>mvn clean</tt> antes de
        comprimir).
    </li>
</ul>
</div>

<hr />

<div class="rodape">
<p>
&copy; Docentes de Sistemas Distribuídos,
<a href="http://www.dei.tecnico.ulisboa.pt/">Dep. Eng. Informática</a>,
<a href="http://www.ist.eu">Técnico Lisboa</a><br />
</p>
</div>

</body></html>
