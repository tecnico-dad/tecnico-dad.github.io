<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
        <link rel="stylesheet" type="text/css" href="../_css/labs-sd.css">
        <link href="../_prettify/prettify.css" type="text/css" rel="stylesheet" />
        <script type="text/javascript" src="../_prettify/prettify.js"></script>
        <title>Apache ZooKeeper</title>
    </head>
    <body onload="prettyPrint()">
        <div class="contexto">
            <p>
                <a href="../index.html">Labs SD</a> &gt;
            </p>
        </div>
        <div class="titulo" id="1">
            <h1>Apache ZooKeeper</h1>
        </div>
        <div class="objectivos">
            <h2>Objetivos</h2>
            <ul>
								<li>Instalação da ferramenta ZooKeeper</li>
                <li>Publicar e pesquisar serviços no servidor de nomes ZooKeeper</li>
            </ul>
        </div>
        <div class="indice"></div>
        <div class="corpo">
        <h2>ZooKeeper</h2>
        <p>
O Apache ZooKeeper é um serviço centralizado para resolver nomes, fornecer informação de configuração e sincronizar conjuntos de servidores distribuídos.<br />

O seu objetivo é simplificar a gestão de serviços, com propagação fiável de alterações de configuração.
						
        </p>
        <h3>Obtenção e Instalação</h3>
        <p>
            
        <li>Obter</li>
        <ul>
            <li>
                <a href="https://zookeeper.apache.org/">Apache ZooKeeper</a>
                <small>(versão <i>stable</i>)</small><br />
            </li>
			<li>
				Obtenha a versão pré-compilada.
				<small>(Versão com binários incluidos)</small>
				<li>exemplo: <i>apache-zookeeper-x.y.z-bin.tar.gz</i></li>
			</li>
        </ul>
        <li>Instalar
		<ul>
			<li>Descompactar para pasta à escolha.</li>
			<li>exemplo: <tt>/home/user/zookeeper</tt></li>
		</ul>
		</li>
			
        <li>Configurar</li>
        <ul>
            <li>Criar a pasta <i>data</i> dentro da pasta de instalação do ZooKeeper.
            	É nesta pasta que o ZooKeeper irá armazenar a informação.
			<ul>
				<li>exemplo: <i>/home/user/zookeeper/data</i></li>
			</ul>
			</li>
            <li>Mudar o nome do ficheiro <i>zookeeper/conf/zoo_sample.cfg</i> para <i>zoo.cfg</i> </li>
            <li>Editar o ficheiro <i>zoo.cfg</i>, alterando as seguintes configurações:
				<ul>
				<li>initLimit=10</li>
				<li>syncLimit=2</li>
				<li>dataDir=/home/user/zookeeper/data</li>
				</ul>
			<li>Repare no campo <i>clientPort</i>
				<ul>este é o porto em que o ZooKeeper estará disponivel</ul>
        </ul>
    
        </p>
		
		<h3>Utilização</h3>
		<p>
			Vamos agora iniciar o servidor do ZooKeeper.

			<ul>
				<li>Navegue até à pasta <i>zookeeper/bin</i></li>
				<li>Corra o comando <tt>./zkServer.sh start</tt></li>
				<li>Deverá obter o seguinte <i>output</i>:</li>
<pre class="prettyprint lang-bash">
    $ Starting zookeeper ... STARTED
</pre>
				<br>
				<li>O ZooKeeper está agora a correr.</li><br>
			</ul>

			Consola de interação com o servidor ZooKeeper

			<ul>
				<li>Novamente na pasta <i>zookeeper/bin</i>, corra o comando <tt>./zkCli.sh</tt></li>
				<ul><li>Este comando inicializa uma consola que permite interagir com o servidor ZooKeeper.</li></ul>
				<li>Na consola correr o comando <tt>ls /</tt></li>
				<ul>Este comando mostra os nós <i>zNodes</i> existentes na <i>raiz (/)</i> do ZooKeeper.</ul>
				<br>
				<li>Crie agora um novo nó com o comando <tt>create</tt></li>
				<ul><li>correr <tt>create /myFirstZnode myFirstData</tt></li>
					<li>Verificar que o nó foi criado com sucesso.</li>
				</ul>
				<li>Verifique que o nó criado contem os dados</li>
				<ul><li>correr o comando <tt>get /myFirstNode</tt></li>
					<li>verificar os dados devolvidos</li>
				</ul>
				<br>

				<li>Vamos agora eliminar o nó criado</li>
				<ul>
					<li>correr o comand <tt>delete /myFirstNode</tt></li>
					<li>verificar com <tt>ls /</tt></li>
				</ul>

				<li>Para finalizar, correr <tt>quit</tt> para encerrar a consola do cliente.</li>

				<li>Para encerrar o servidor, corra o comando <tt>./zkServer.sh stop</tt></li>.</li>
				<br>
			</ul>
		</p>
		
<h3>Utilização do ZooKeeper para registo de serviços</h3>

<p>
Os endereços -- servidor e porto -- de serviços gRPC devem ser descobertos de forma dinâmica, para evitar que fiquem fixos no código das aplicações.
Isto permite que o endereço mude sempre que necessário, sem recompilação dos clientes.
Permite também que existam diversas réplicas de servidores para contactar alternativamente.
</p>

<p>
As funcionalidades do ZooKeeper vão para além de um simples servidor de nomes.
Para tornar a utilização do ZooKeeper mais simples foi criada a biblioteca <tt>ZKNaming</tt> que oferece as operações <tt>rebind</tt> e <tt>lookup</tt>.
Esta biblioteca torna o registo e pesquisa de serviços mais sucinto.
O código fonte está disponível para consulta e modificação, caso sejam necessárias mais funcionalidades do ZooKeeper.
</p>

Mais informação:
<!--ul>
    <li--><a href="zk-naming/apidocs/index.html">ZKNaming JavaDoc</a><!--/li>
</ul-->

<h3>Exercício</h3>

<p>
O objetivo do exercício é usar a biblioteca ZKNaming para que o servidor <tt>grpc-hello</tt> (da aula anterior) se registe no ZooKeeper,
com o nome <tt>/svc/hello</tt>.
Depois, o cliente deve obter o <tt>host:port</tt> do servidor, ligando-se ao ZooKeeper.
</p>
<p>
O endereço (e porto) do ZooKeeper deve ser passado como argumento para os programas.
</p>
		
        <hr />
        <div class="rodape">
            <p>
                &copy; Docentes de Sistemas Distribuídos,
                <a href="http://www.dei.tecnico.ulisboa.pt/">Dep. Eng. Informática</a>,
                <a href="http://www.ist.eu">Técnico Lisboa</a><br />
            </p>
        </div>
    </body>
</html>