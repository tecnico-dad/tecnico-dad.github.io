<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1" >
    <link rel="stylesheet" type="text/css" href="../_css/labs-sd.css">

    <link href="../_prettify/prettify.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="../_prettify/prettify.js"></script>

    <title>Criptografia</title>
</head>

<body onload="prettyPrint()">

<body>

<div class="contexto">
    <p>
        <a href="../index.html">Labs SD</a> &gt;
    </p>
</div>

<div class="titulo" id="1">
    <h1>Criptografia</h1>
</div>

<!--div class="objectivos">
    <h2>Objectivos</h2>
    <ul>
        <li>Utilizar os mecanismos criptogr&aacute;ficos da plataforma Java aplicados a documentos XML</li>
    </ul>
</div-->
<!--/br-->
<!--div class="laboratorio">
    <h2>No laborat&oacute;rio:</h2>
    <ul>
        <li>Esclarecer d&uacute;vidas</li>
        <li>Terminar o exerc&iacute;cio Assinatura digital e MAC</li>
    </ul>
</div-->

<div class="indice">
</div>

<div class="corpo">
    <!--h2 id="conteudos">Conte&uacute;dos</h2-->
    <p class="textos">Resumos:
        <ul>
            <li><a href="criptografia/index.html">Mecanismos criptogr&aacute;ficos</a></li>
            <li><a href="seguranca-java/index.html">Seguran&ccedil;a na plataforma Java</a></li>
            <li><a href="binarios-texto/index.html">Representa&ccedil;&atilde;o de dados bin&aacute;rios em texto</a></li>
        </ul>
    </p>
    <p class="exemplos">Exemplos:
        <ul>
            <li>
            <a href="crypto.zip">Testes de Criptografia em Java
            <img src="../_img/zip.png" alt="ZIP" ></a>
            </li>
            <ul>
                <li><b>Cifra sim&eacute;trica</b></li>
                <li><b>Cifra assim&eacute;trica</b></li>
                <li>Resumo (<i>digest</i>)</li>
                <li>Gera&ccedil;&atilde;o de n&uacute;meros aleat&oacute;rios seguros</li>
                <li>Assinaturas digitais</li>
                <li>Leitura e escrita de chaves criptogr&aacute;ficas</li>
                <li>Criptografia em texto (XML)</li>
            </ul>
        </ul>
&nbsp;&nbsp;&nbsp;&nbsp;Para executar apenas o teste da cifra assimétrica, escrever:<br />
&nbsp;&nbsp;&nbsp;&nbsp;<tt>mvn test -Dtest=AsymCrypto*#testCipherPublic*</tt><br />
        &nbsp;<br />
        
        <ul>
            <li>
            <a href="cert-util.zip">Certificados digitais
            <img src="../_img/zip.png" alt="ZIP" ></a>
            </li>
                <ul>
                    <li><b>Assinaturas digitais</b></li>
                    <ul>
                        <li>com chave privada em <b><i>keystore</i></b></li>
                        <li>com chave pública em <b>certificados X.509</b></li>
                    </ul>
                    <li>Verificação de assinatura de certificado</li>
                </ul>
        </ul>
&nbsp;&nbsp;&nbsp;&nbsp;Para executar apenas os testes de assinatura digital, escrever:<br />
&nbsp;&nbsp;&nbsp;&nbsp;<tt>mvn test -Dtest=X509DigitalSig*</tt><br />
        &nbsp;<br />

    </p>

<p>
&nbsp;
</p>
<h1>Exercício</h1>
<h2>Terceira parte do projeto</h2>
<p>
O <a href="../proj/P3_continue.zip">ponto de continuação</a> contém novos módulos,
nomeadamente o módulo <tt>security</tt> onde deverão ser criadas classes para a implementação da segurança
(criptografia, <i>handlers</i>, etc).<br />
Começar por editar os <tt>pom.xml</tt> para substituir <tt>CXX</tt> pelo identificador do grupo.<br />
Adicionar os novos módulos ao projeto no Git.
</p>

<p>&nbsp;</p>

<p>
O objetivo deste exercício é criar métodos para proteger dados com uma cifra assimétrica.<br />
Uma chave pública será usada para cifrar os dados.<br />
Uma chave privada será usada para decifrar.<br />
Deste modo é possível garantir que apenas o dono da chave privada consegue ler a informação cifrada.
</p>
<ol>
    <li>
    Criar a classe <tt>CryptoUtil</tt> no módulo <tt>security</tt>.
    </li>
    <li>
    Criar método <tt>asymCipher()</tt> que recebe dados (<tt>byte[]</tt>) e
    uma chave e 
    devolve esses dados cifrados.
    </li>
    <ul>
        <li>
        Usar <tt>javax.crypto.<b>Cipher</b></tt> para <tt>"RSA/ECB/PKCS1Padding"</tt>
        </li>
        <li>
        Cifrar com:<br />
        <tt>cipher.init(Cipher.ENCRYPT_MODE, publicKey);</tt><br />
		<tt>byte[] cipherBytes = cipher.doFinal(plainBytes);</tt>
        </li>
    </ul>
    <li>
    Criar o método <tt>asymDecipher()</tt> na classe que recebe os dados cifrados e
    uma chave e
    devolve os dados decifrados.
    </li>
    <ul>
        <li>
        Decifrar com:<br />
        <tt>cipher.init(Cipher.DECRYPT_MODE, privateKey);</tt>
        </li>
    </ul>
    <li>
    Criar testes JUnit na classe <tt>CryptoUtilTest</tt> para verificar o funcionamento correto dos métodos implementados.
    </li>
    <ul>
        <li>
        E também para verificar o que acontece quando algo não está correto (ex. chave errada, dados adulterados, etc).
        </li>
    </ul>
</ol>

<i>Sugestões:</i>
<ul>
    <li>
    Utilize este par de chaves para testes (coloque os ficheiros em <tt>src/test/resources</tt>):
    </li>
    <ul>
        <li>
        Chave pública armazenada em <a href="example.cer">certificado</a>
        </li>
        <!--ul>
            <li>
            <a href="example-ca.cer">Certificado CA</a>
            </li>
        </ul-->
        <li>
        Chave privada armazenada em <a href="example.jks"><i>keystore</i></a>
        </li>
        <ul>
            <li><small>
            Store password: <tt>1nsecure</tt>
            </small></li>
            <li><small>
            Key password: <tt>ins3cur3</tt>
            </small></li>
        </ul>
    </ul>
    <li>
    Pode imprimir os dados binários em texto com
    <tt>javax.xml.bind.DatatypeConverter.printHexBinary</tt> (hexadecimal)
    ou <tt>printBase64Binary</tt> (base 64)
    </li>
    <li>
    Melhore o código para lidar bem com as <a href="../01-tools/exceptions/index.html">exceções</a>.
    </li>
</ul>

<p>&nbsp;</p>

<p>
<b>Próximos passos</b>:
</p>
<!--ul>
    <li>
    Qual é o tamanho limite para os dados que podem ser cifrados com a técnica anterior?
    </li>
    <li>
    Criar métodos na <tt>CryptoUtil</tt> para cifrar/decifrar com chaves simétricas
    </li>
    <ul>
        <li>
        Faz sentido combinar cifra simétrica com assimétrica?<br />
        Em que situações?
        </li>
    </ul>
</ul-->
<ul>
    <li>
    Criar métodos na classe <tt>CryptoUtil</tt> para fazer e verificar assinatura digital
    </li>
    <ul>
        <li>
        Usar <tt>java.security.<b>Signature</b></tt> para <tt>"SHA256withRSA"</tt>
        </li>
    </ul>
</ul>
<ul>
    <li>
    Usar a classe <tt>CryptoUtil</tt> juntamente com <i>Handlers</i> intercetores de mensagens SOAP 
    para proteger as comunicações no projeto
    </li>
    <ul>
        <li>
        Adicionar a dependência para o módulo <tt>security</tt> onde necessário
        </li>
        <li>
        A comunicação entre <tt>mediator-ws-cli</tt> e <tt>mediator-ws</tt>
        deve ocultar o número do cartão de crédito
        </li>
        <li>
        A comunicação entre <tt>supplier-ws-cli</tt> e <tt>supplier-ws</tt>
        deve garantir a autenticidade, integridade e frescura das mensagens
        </li>
    </ul>
</ul>

<p>&nbsp;</p>

<p>
<b>Bom trabalho!</b>
</p>

</div>

<hr />

<div class="rodape">
<p>
&copy; Docentes de Sistemas Distribuídos,
<a href="http://www.dei.tecnico.ulisboa.pt/">Dep. Eng. Informática</a>,
<a href="http://www.ist.eu">Técnico Lisboa</a><br />
</p>
</div>

</body></html>
