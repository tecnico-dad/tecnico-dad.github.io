<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
    <link rel="stylesheet" type="text/css" href="../_css/labs-sd.css">

    <link href="../_prettify/prettify.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="../_prettify/prettify.js"></script>

    <title>UDDI (Web Services II)</title>
</head>

<body onload="prettyPrint()">

<div class="contexto">
    <p>
        <a href="../index.html">Labs SD</a> &gt;
    </p>
</div>

<div class="titulo" id="1">
    <h1>Web Services II: UDDI</h1>
</div>

<div class="objectivos">
    <h2>Objetivos</h2>
    <ul>
        <li>
        Publicar e pesquisar <i>Web Services</i> no servidor de nomes jUDDI
        </li>
        <li>
        Ver exemplo de <i>Web Service</i> em Java construído com a abordagem <i>implementation-first</i>
        </li>
    </ul>
    <h3>Projeto:</h3>
    <ul>
        <li>Modificar o fornecedor da parte 1 para usar UDDI</li>
        <li>Concretizar a operação <tt>ping</tt> do <tt>mediator-ws</tt> para contactar todos os fornecedores que encontrar</li>
    </ul>
</div>

<div class="indice">
</div>


<div class="corpo">

<h2>UDDI</h2>

<p>
Para a publicação e pesquisa de <i>Web Services</i>
usa-se um servidor de nomes que implementa a norma
UDDI (<i>Universal Description, Discovery and Integration</i>).
</p>
<p>
Comparando com as outras tecnologias de chamada remota:
no Sun RPC usa-se o <tt>rpcbind</tt>,
no Java RMI usa-se o <tt>rmiregistry</tt>,
nos Web Services usa-se o <tt>UDDI</tt>.
</p>

Mais informação:
<!--ul>
    <li--><a href="uddi/index.html">UDDI</a><!--/li>
</ul-->

<h3>JAX-R</h3>

<p>
Para comunicar com servidores UDDI,
existe a biblioteca JAX-R (Java API for XML Registries),
que permite publicar, pesquisar e eliminar registos de <i>Web Services</i>.
</p>

<p>
O esquema de dados do UDDI é consideravelmente mais rico do que o habitual num servidor de nomes,
com diversas entidades e relações,
que permitem guardar informação de negócio sobre a organização e os seus serviços.
Como consequência, o JAX-R é uma biblioteca verbosa,
que obriga a escrever muitas linhas de código para realizar as tarefas mais habituais de registo e de pesquisa.
</p>

Mais informação:
<!--ul>
    <li--><a href="jaxr/index.html">JAX-R</a><!--/li>
</ul-->

<h3>UDDI Naming</h3>

<p>
Para tornar a utilização do UDDI mais simples
foi criada a biblioteca <tt>UDDINaming</tt> que simplifica o esquema de dados para suportar apenas:
1 organização, 1 serviço e 1 implementação.<br />
Esta biblioteca,
cujo código está disponível para consulta e modificação,
torna o registo e pesquisa de serviços mais sucinto.
</p>

Mais informação:
<!--ul>
    <li--><a href="uddi-naming/apidocs/index.html">UDDINaming JavaDoc</a><!--/li>
</ul-->

<p>
&nbsp;
</p>
<hr />


<h2>Exemplo</h2>

<p>
O exemplo seguinte é um <i>Web Service</i> que se regista no UDDI:
<ul>
    <li>
    <a href="hello-ws_juddi.zip">Web Service <img src="../_img/zip.png" alt="ZIP" ></a>
    </li>
    <li>
    <a href="hello-ws-cli_juddi.zip">client <img src="../_img/zip.png" alt="ZIP" ></a>
    </li>
</ul>

<p>
<b>Nota:</b>
na aula passada vimos <i>Web Services</i> construídos a partir do contrato WSDL,
mas os serviços podem também ser construídos a partir de código Java já existente, numa abordagem que se designa por <i>implementation-first</i>.<br />
No exemplo acima segue-se esta abordagem:
a interface <tt>Hello</tt> foi anotada com <tt>@WebService</tt> e
o WSDL é depois gerado automaticamente quando o servidor é lançado.
</p>

<p>
Seguem-se instruções detalhadas para construir e 
executar o exemplo.
<!-- de um <i>Web Service</i> feito em Java,
que usa a biblioteca <tt>UDDINaming</tt> para comunicar com o servidor de nomes.-->
</p>

<p>
<b>jUDDI (<i>Java UDDI</i>)</b>
</p>
<ol>
    <li>
    O servidor de nomes a utilizar é o jUDDI
    alojado na RNL.
    </li>
    <ul>
        <li>
        Para usar basta configurar a propriedade 
        <tt>uddi.url</tt> com o seguinte valor:
        <tt>http://user:pass@uddi.sd.rnl.tecnico.ulisboa.pt:9090/</tt>
        </li>
        <li>
        Os valores de <i>user</i> e <i>pass</i> para acesso ao UDDI devem ser pedidos ao professor no laboratório.
        </li>
    </ul>
    <li>
    Para que a configuração seja feita para todos os exemplos, 
    pode-se criar um perfil Maven que sobrepõe o valor da propriedade para todos os projetos do utilizador.
    Para isso, criar um ficheiro <tt><a href="settings.xml">settings.xml</a></tt> na pasta <tt>.m2</tt> da <i>home</i> do utilizador.
    </li>
</ol>
<ul>
    <li>
    Em alternativa ao jUDDI da RNL, pode-se usar um jUDDI local:
    </li>
    <ul>
        <li>
        O pacote de instalação pode ser encontrado na lista de <a href="../software/index.html">software</a> que se pediu para instalar.
        </li>
        <li>
        Para lançar o servidor,
        basta executar o seguinte comando na pasta <tt>juddi-.../bin</tt>:
        </li>
        <ul>
            <li>
            <tt>startup.sh</tt> (Linux e Mac)
            </li>
            <li>
            <tt>startup.bat</tt> (Windows)
            </li>
        </ul>
        <ul>
            <li>
            <tt>juddi-startup</tt> / <tt>juddi-shutdown</tt> (laboratórios das aulas)
            </li>
        </ul>
        <!--li>
        Para confirmar o funcionamento do servidor,
        aceder à página de índice do jUDDI, 
        que dá também acesso à interface de administração<br />
        <a href="http://localhost:9090/juddiv3/">http://localhost:9090/juddiv3/</a>
        </li>
        <ul>
            <li>utilizador:senha <tt>uddiadmin:da_password1</tt></li>
        </ul-->
    </ul>
</ul>

<p>
<b>UDDINaming</b>
</p>
<ol>
    <li>
    Obter o código da biblioteca <tt>UDDINaming</tt>:
    </li>
    <ul>
        <li>
        <a href="uddi-naming.zip">Biblioteca uddi-naming
        <img src="../_img/zip.png" alt="ZIP"></a>
        </li>
    </ul>
    <li>
    Instalar o módulo no repositório Maven local:
    </li>
    <ul>
        <li>
        <tt>cd uddi-naming</tt>
        </li>
        <li>
        <tt>mvn install</tt>
        </li>
        <li>
        A biblioteca inclui testes de integração 
        (IT - <i>Integration Tests</i>)<br />
        que verificam o funcionamento correto do jUDDI antes de instalar o módulo.
        </li>
        <li>
        Uma vez instalado o módulo no repositório Maven local,
        a biblioteca pode ser usada como dependência em qualquer <tt>pom.xml</tt>.
        </li>
    </ul>
</ol>

<p>
<b>Servidor JAX-WS</b>
</p>
<ol>
    <li>
    Construir e executar o servidor:
    </li>
    <ul>
        <li>
        <tt>cd hello-ws_juddi</tt>
        </li>
        <li>
        <tt>mvn compile exec:java</tt><br />
        O nome da classe a executar e 
        os argumentos estão definidos no <tt>pom.xml</tt><br />
        O servidor deve executar sem erros,
        disponibilizando o <i>endpoint address</i> e
        registando-se no UDDI.
        </li>
    </ul>
    <li>
    Confirmar que o servidor está à espera de pedidos,<br />
    consultando o contrato que é gerado automaticamente:
    </li>
    <ul>
        <li>
        <a href="http://localhost:8080/hello-ws/endpoint?wsdl">http://localhost:8080/hello-ws/endpoint?wsdl</a>
        </li>
        <li>
        <a href="http://localhost:8080/hello-ws/endpoint?xsd=1">http://localhost:8080/hello-ws/endpoint?xsd=1</a>
        </li>
    </ul>
</ol>

<p>
<b>Cliente JAX-WS</b>
</p>
<ol>
    <li>
    Construir o cliente:
    </li>
    <ul>
        <li>
        <tt>cd hello-ws-cli_juddi</tt>
        </li>
        <li>
        <tt>mvn compile</tt><br />
        Executa previamente <tt>generate-sources</tt> onde
        o cliente obtém o contrato WSDL a partir do servidor e<br />
        usa a ferramenta <tt>wsimport</tt> para gerar as classes de invocação do serviço
        (em <tt>target/</tt>)<br />
        </li>
    </ul>
    <li>
    Executar o cliente:
    </li>
    <ul>
        <li>
        <tt>mvn exec:java</tt><br />
        O cliente deve executar sem erros,
        consultando o UDDI para descobrir o endereço do servidor,<br />
        e fazendo uma invocação remota.
        </li>
    </ul>
</ol>

<p>
Resumindo:<br />
primeiro foi configurado o servidor de nomes jUDDI da RNL.<br />
Depois foi instalada a biblioteca UDDINaming no repositório Maven local,
que testa também o funcionamento do servidor jUDDI.<br />
Em seguida,
foi construído e iniciado o servidor,
que se regista no jUDDI e 
fica à espera de pedidos no <i>endpoint address</i>.<br />
Finalmente,
o cliente obtém o WSDL a partir do servidor e 
gera o código de invocação que permite depois fazer invocações remotas.
</p>
<p>
Visão global do exemplo Hello World: <a href="../05-ws1/ping/uml_full.png"><img src="../_img/uml.png" alt="UML" ></a>
</p>
<!--p>
Depois de testado o Exemplo,
passar ao Exercício.
</p-->

<p>
&nbsp;
</p>
<hr />

<h1>Exercício</h1>
<h2>Segunda parte do Projeto</h2>

<p>
Nesta parte devem surgir múltiplos fornecedores e
aparece também o serviço <tt>mediator-ws</tt> que os vai pesquisar e 
depois consultar.
Assim sendo, o UDDI torna-se útil e necessário.
</p>

<p>
O <a href="../proj/P2_continue.zip">ponto de continuação</a> contém novos ficheiros (serão disponibilizados após a primeira entrega).
Editar os <tt>pom.xml</tt> para substituir <tt>CXX</tt> pelo identificador do grupo.
</p>

<p>
Pretende-se agora modificar <tt>supplier-ws</tt> 
<a href="../proj/uml/uml_server.png"><img src="../_img/uml.png" alt="UML" ></a>
para se registar no UDDI.
</p>
<ol>
    <li>
    Adicionar a dependência para a biblioteca UDDINaming:<br />
<pre class="prettyprint lang-xml">
    ...
    &lt;!-- UDDI Naming --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;pt.ulisboa.tecnico.sdis&lt;/groupId&gt;
        &lt;artifactId&gt;uddi-naming&lt;/artifactId&gt;
        &lt;version&gt;1.2&lt;/version&gt;
    &lt;/dependency&gt;
    ...
</pre>
    </li>
    <li>
    A <tt>SupplierApp</tt> deverá receber o endereço do UDDI e o nome do serviço como argumento.
    </li>
    <li>
    O <tt>SupplierEndpointManager</tt> deverá ter um novo construtor que recebe o endereço do UDDI e 
    o nome do serviço, e 
    que efetua o registo 
    (e apaga quando o serviço termina).
    </li>
    <li>
    Feitas as alterações, 
    o servidor deverá iniciar-se,
    registar-se no UDDI e depois ficar à espera de pedidos.
    </li>
</ol>

<p>
"Multiplicar" o <tt>supplier-ws</tt>.
</p>
<ol>
    <li>
    A forma mais simples de permitir múltiplas instâncias do fornecedor é
    parametrizar as propriedades de configuração com um número de instância.
    </li>
    <li>
    Adicionar as seguintes definições ao <tt>pom.xml</tt> 
    (substituir CXX pelo identificador do grupo):<br />
<pre class="prettyprint lang-xml">
    ...
    &lt;ws.i&gt;1&lt;/ws.i&gt;

    &lt;ws.host&gt;localhost&lt;/ws.host&gt;
    &lt;ws.port&gt;808${ws.i}&lt;/ws.port&gt;
    &lt;ws.url&gt;http://${ws.host}:${ws.port}/supplier-ws/endpoint&lt;/ws.url&gt;
    
    &lt;ws.name&gt;CXX_Supplier${ws.i}&lt;/ws.name&gt;
    ...
</pre>
    </li>
    <li>
    Para lançar um fornecedor:
    </li>
    <ul>
        <li>
        <tt>mvn compile</tt>
        </li>
        <li>
        <tt>mvn exec:java</tt><br />
        Por omissão, será a instância 1, 
        que fica à escuta de pedidos no porto 8081 e 
        que se regista com o nome CXX_Supplier1.
        </li>
    </ul>
    <li>
    Para lançar outro fornecedor:
    </li>
    <ul>
        <li>
        <tt>mvn exec:java <b>-Dws.i=2</b></tt><br />
        A instância <b>2</b> fica à escuta de pedidos no porto 808<b>2</b> e
        regista-se com o nome CXX_Supplier<b>2</b>.
        </li>
    </ul>
</ol>

<p>
Pretende-se agora modificar <tt>supplier-ws-cli</tt>
<a href="../proj/uml/uml_client.png"><img src="../_img/uml.png" alt="UML" ></a>
para pesquisar no UDDI.
</p>
<ol>
    <li>
    Adicionar a dependência para a biblioteca UDDINaming.
    </li>
    <li>
    O <tt>SupplierClient</tt> deverá ter um novo construtor que recebe o endereço do UDDI e 
    o nome do serviço a contactar, e 
    que efetua a pesquisa para localizar o servidor.
    </li>
    <li>
    A <tt>SupplierClientApp</tt> deverá receber o endereço do UDDI e 
    o nome do serviço como argumento.
    </li>
</ol>

<p>
Vamos construir uma operação simples do servidor <tt>mediator-ws</tt> que contacta os fornecedores.
</p>
<ol>
    <li>
    O <tt>mediator-ws</tt> vai ser cliente de <tt>supplier-ws</tt>.<br />
    Em vez de repetir código,
    vamos usar o objeto <tt>SupplierClient</tt>,
    já desenvolvido e testado.<br /><br />
    </li>
    <ol type="a">
        <li>
        Em primeiro lugar, instalar o módulo do cliente do fornecedor:<br />
        <tt>cd supplier-ws-cli</tt><br />
        <tt>mvn install</tt><br />
        <!--tt>mvn install -Dtest.skip=true</tt-->
        </li>
        <li>
        Depois, 
        acrescentar a dependência Maven no <tt>mediator-ws/pom.xml</tt>
        (substituir CXX pelo identificador do grupo):
<pre class="prettyprint lang-xml">
    ...
    &lt;dependency&gt;
        &lt;groupId&gt;org.komparator.CXX&lt;/groupId&gt;
        &lt;artifactId&gt;supplier-ws-cli&lt;/artifactId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    ...
</pre>
        O sistema em funcionamento terá três processos:
        </li>
        <ul>
            <li>
            O cliente de testes do mediator;
            </li>
            <li>
            O mediator 
            (que engloba o código dos módulos 
            <tt>mediator-ws</tt> e <tt>supplier-ws-cli</tt>);
            </li>
            <li>
            O(s) servidor(es) do(s) fornecedor(es).
            </li>
            <a href="../proj/uml_deployment.png"><img src="../_img/uml.png" alt="UML" ></a>
        </ul>
        <br />
        
        </li>
    </ol>
    <li>
    Concretizar a operação <tt>ping</tt> do mediador.
    </li>
    <ul>
        <li>
        Consultar o UDDI para pesquisar fornecedores.
        </li>
        <li>
        Criar um <tt>SupplierClient</tt> para cada fornecedor encontrado.
        </li>
        <li>
        Chamar a operação <tt>ping</tt> de cada um.</li>
        <li>
        Juntar as respostas e
        devolver como resultado.
        </li>
    </ul>
</ol>

<p>
Finalmente,
usar o <tt>mediator-ws-cli</tt> para chamar o <tt>ping</tt> que vai tocar o mediador e todos os fornecedores.
</p>
<ul>
    <li>
    Abrir consola para Fornecedor 1:
    </li>
    <ul>
        <li>
        <tt>cd supplier-ws</tt>
        </li>
        <li>
        <tt>mvn compile exec:java</tt>
        </li>
    </ul>
    <li>
    Abrir consola para Fornecedor 2:
    </li>
    <ul>
        <li>
        <tt>cd supplier-ws</tt>
        </li>
        <li>
        <tt>mvn compile exec:java -Dws.i=2</tt>
        </li>
    </ul>
    <li>
    Abrir consola para Mediador:
    </li>
    <ul>
        <li>
        <tt>cd mediator-ws</tt>
        </li>
        <li>
        <tt>mvn compile exec:java</tt>
        </li>
    </ul>
    <li>
    Finalmente, na consola para o cliente do Mediador:
    </li>
    <ul>
        <li>
        <tt>cd mediator-ws-cli</tt>
        </li>
        <li>
        <tt>mvn compile exec:java</tt><br />
        O resultado final do <tt>ping</tt> deverá ser impresso nesta consola.
        </li>
    </ul>
</ul>

<p>
<b>O que falta fazer?</b>
</p>
<ul>
    <li>
    No <tt>mediator-ws</tt>:
    </li>
    <ul>
        <li>
        Implementar todas as operações de acordo com o enunciado
        </li>
        <li>
        Fazer um bom tratamento de <a href="../01-tools/exceptions/index.html">exceções</a>
        </li>
        <li>
        Não esquecer também que o servidor é multi-tarefa (<i>thread</i>) e 
        que os acessos a dados partilhados devem ser devidamente sincronizados
        </li>
    </ul>
    <li>
    No <tt>mediator-ws-cli</tt>:
    </li>
    <ul>
        <li>
        Fazer testes de integração das operações principais
        </li>
        <ul>
            <li>
            Testar casos mais importantes
            <li>
            Não esquecer os casos com entradas incorretas: <tt>null</tt>, <tt>""</tt>, valores inesperados, etc
            </li>
        </ul>
        <li>
        Os testes de integração correm com <tt>mvn verify</tt>
        </li>
    </ul>
</ul>

<p>
<b>Continuação de bom trabalho!</b>
</p>


</div>

<hr />




<div class="rodape">
<p>
&copy; Docentes de Sistemas Distribuídos,
<a href="http://www.dei.tecnico.ulisboa.pt/">Dep. Eng. Informática</a>,
<a href="http://www.ist.eu">Técnico Lisboa</a><br />
</p>
</div>

</body></html>
